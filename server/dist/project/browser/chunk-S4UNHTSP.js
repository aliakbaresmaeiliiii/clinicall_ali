import{a as he}from"./chunk-QSQT2X5K.js";import{a as ge}from"./chunk-WBBEKRP3.js";import{b as le}from"./chunk-QPNUN4VI.js";import{n as re}from"./chunk-EGMUEH5E.js";import{b as de,d as ce}from"./chunk-K6R64PTY.js";import{b as se}from"./chunk-5MOUG5TN.js";import{$ as W,U as Q,b as ie,gb as ne,ob as oe,sb as ae}from"./chunk-JG53XC6X.js";import{Aa as B,Cb as _,Hb as P,Mb as S,Nb as O,Pb as ee,Qb as te,Rb as g,Sb as m,Tb as w,Xb as $,_b as D,ab as K,ac as M,da as Z,ea as I,fb as v,gb as V,ia as J,ja as X,kc as b,lb as Y,na as z,oa as F,ob as N,qd as T,rc as G,sc as A,xa as U,ya as j,za as E}from"./chunk-S2IW6LC3.js";import{a as y,b as C,j as R}from"./chunk-PXA7OGPQ.js";var me=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=F({type:e}),e.\u0275inj=I({imports:[W,Q,W,Q]});let t=e;return t})();var u=function(t){return t[t.Up=1]="Up",t[t.Down=3]="Down",t[t.Right=6]="Right",t[t.Left=8]="Left",t[t.UpMirrored=2]="UpMirrored",t[t.DownMirrored=4]="DownMirrored",t[t.LeftMirrored=5]="LeftMirrored",t[t.RightMirrored=7]="RightMirrored",t[t.Default=0]="Default",t[t.NotJpeg=-1]="NotJpeg",t[t.NotDefined=-2]="NotDefined",t}(u||{}),q=class{constructor(){this.byteCount=e=>encodeURI(e).split(/%..|./).length-1}getOrientation(e){return new Promise((s,i)=>{try{let n=new FileReader;n.onload=()=>{let o=new DataView(n.result);if(!o.byteLength||o.getUint16(0,!1)!==65496)return s(u.NotDefined);let a=o.byteLength,r=2;for(;r<a;){let l=o.getUint16(r,!1);if(r+=2,l===65505){if(o.getUint32(r+=2,!1)!==1165519206)return s(u.NotJpeg);let p=o.getUint16(r+=6,!1)===18761;r+=o.getUint32(r+4,p);let h=o.getUint16(r,p);r+=2;for(let d=0;d<h;d++)if(o.getUint16(r+d*12,p)===274)return s(o.getUint16(r+d*12+8,p))}else{if((l&65280)!==65280)break;r+=o.getUint16(r,!1)}}return s(u.NotJpeg)},n.readAsArrayBuffer(e)}catch{return i(u.Default)}})}uploadFile(e,s=!0,i=!1){return new Promise((n,o)=>{let a=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),r=/iPad|iPhone|iPod/i.test(navigator.userAgent);Promise.resolve(a||r).then(l=>l?this.generateUploadInputNative(window.document,s,i):this.generateUploadInputRenderer(e,s,i)).then(l=>{let p=l?Array.from(l):[],h=p.map(f=>this.getOrientation(f)),d=p.map(f=>this.fileToDataURL(f)),c=[];Promise.all(h).then(f=>(c=f,Promise.all(d))).then(f=>{let x=f.map((k,H)=>({image:k.dataUrl,orientation:c[H],fileName:k.fileName}));n(s?x:x[0])})}).catch(l=>o(l))})}fileToDataURL(e){return new Promise((s,i)=>{let n=new FileReader;n.onload=o=>{s({dataUrl:o.target.result,fileName:e.name})};try{n.readAsDataURL(e)}catch(o){i(`ngx-image-compress - probably no file have been selected: ${o}`)}})}generateUploadInputRenderer(e,s=!0,i=!1){let n=!1;return new Promise((o,a)=>{let r=e.createElement("input");e.setStyle(r,"display","none"),e.setProperty(r,"type","file"),e.setProperty(r,"accept","image/*, .heic"),s&&e.setProperty(r,"multiple","true"),e.listen(r,"click",l=>{l.target.value=""}),e.listen(r,"change",l=>{n=!0;let p=l.target.files;o(p)}),i&&window.addEventListener("focus",()=>{setTimeout(()=>{n||a(new Error("file upload on blur - no file selected"))},300)},{once:!0}),r.click()})}generateUploadInputNative(e,s=!0,i=!1){let n=!1;return new Promise((o,a)=>{let r=e.createElement("input");r.id="upload-input"+new Date,r.style.display="none",r.setAttribute("type","file"),r.setAttribute("accept","image/*, .heic"),s&&r.setAttribute("multiple","true"),e.body.appendChild(r),r.addEventListener("change",()=>{n=!0,o(r.files),e.body.removeChild(e.getElementById(r.id))},{once:!0}),i&&window.addEventListener("focus",()=>{setTimeout(()=>{!n&&e.getElementById(r.id)&&(a(new Error("file upload on blur - no file selected")),e.body.removeChild(e.getElementById(r.id)))},300)},{once:!0}),r.click()})}compress(e,s,i,n=50,o=50,a=0,r=0){return new Promise(function(l,p){o=o/100,n=n/100;let h=new Image;h.onload=()=>{let d=i.createElement("canvas"),c=d.getContext("2d");if(!c)return p("No canvas context available");let f=h.naturalWidth,x=h.naturalHeight;if(!CSS.supports("image-orientation","from-image")&&(s===u.Right||s===u.Left)){let ve=f;f=x,x=ve}let k=a?a/f:1,H=r?r/x:1;n=Math.min(n,k,H),d.width=f*n,d.height=x*n;let L=Math.PI/180;CSS.supports("image-orientation","from-image")||s===u.Up?c.drawImage(h,0,0,d.width,d.height):s===u.Right?(c.save(),c.rotate(90*L),c.translate(0,-d.width),c.drawImage(h,0,0,d.height,d.width),c.restore()):s===u.Left?(c.save(),c.rotate(-90*L),c.translate(-d.width,0),c.drawImage(h,0,0,d.height,d.width),c.restore()):s===u.Down?(c.save(),c.rotate(180*L),c.translate(-d.width,-d.height),c.drawImage(h,0,0,d.width,d.height),c.restore()):c.drawImage(h,0,0,d.width,d.height);let we=e.substr(5,e.split(";")[0].length-5),xe=d.toDataURL(we,o);l(xe)},h.onerror=d=>p(d),h.src=e})}uploadGetImageMaxSize(e,s,i,n=!1){return R(this,null,function*(){s&&console.debug("Ngxthis - Opening upload window");let o=yield this.uploadFile(i,!1,n);return yield this.getImageMaxSize(o,e,s,i)})}getImageMaxSize(e,s,i,n){return R(this,null,function*(){let a=l=>(l/1024/1024).toFixed(2);i&&console.debug("Ngxthis - Opening upload window");let r;for(let l=0;l<10;l++){let p=this.byteCount(e.image);r=yield this.compress(e.image,e.orientation,n,50,100);let h=this.byteCount(r);if(console.debug("Ngxthis -","Compression from",a(p),"MB to",a(h),"MB"),h>=p)throw l===0?(i&&console.debug("Ngxthis -","File can't be reduced at all - returning the original",a(p),"MB large"),C(y({},e),{image:r})):(i&&console.debug("Ngxthis -","File can't be reduced more - returning the best we can, which is ",a(p),"MB large"),C(y({},e),{image:r}));if(h<s*1024*1024)return i&&console.debug("Ngxthis -","Here your file",a(h),"MB large"),C(y({},e),{image:r});if(l===9)throw i&&console.debug("Ngxthis -","File can't reach the desired size after",10,"tries. Returning file ",a(p),"MB large"),C(y({},e),{image:r});i&&console.debug("Ngxthis -","Reached",a(h),"MB large. Trying another time after",l+1,"times"),e.image=r}throw i&&console.debug("Ngxthis - Unexpected error"),{}})}},ue=(()=>{let e=class e{constructor(i){this.DOC_ORIENTATION=u,this.render=i.createRenderer(null,null),this.imageCompress=new q}byteCount(i){return this.imageCompress.byteCount(i)}getOrientation(i){return this.imageCompress.getOrientation(i)}uploadFile(){return this.imageCompress.uploadFile(this.render,!1)}uploadMultipleFiles(){return this.imageCompress.uploadFile(this.render,!0)}uploadFileOrReject(){return this.imageCompress.uploadFile(this.render,!1,!0)}uploadMultipleFilesOrReject(){return this.imageCompress.uploadFile(this.render,!0,!0)}compressFile(i,n,o=50,a=50,r=0,l=0){return this.imageCompress.compress(i,n,this.render,o,a,r,l)}uploadAndGetImageWithMaxSize(i=1,n=!1,o=!1){return this.imageCompress.uploadGetImageMaxSize(i,n,this.render,o).then(a=>a.image).catch(a=>{throw a.image})}uploadAndGetImageWithMaxSizeAndMetas(i=1,n=!1,o=!1){return this.imageCompress.uploadGetImageMaxSize(i,n,this.render,o)}getImageWithMaxSizeAndMetas(i,n=1,o=!1){return this.imageCompress.getImageMaxSize(i,n,o,this.render)}};e.\u0275fac=function(n){return new(n||e)(J(Y))},e.\u0275prov=Z({token:e,factory:e.\u0275fac,providedIn:"root"});let t=e;return t})();var fe=(()=>{let e=class e{};e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=F({type:e}),e.\u0275inj=I({imports:[T]});let t=e;return t})();function Me(t,e){t&1&&(g(0,"div",1),E(),g(1,"svg",12),w(2,"g",5)(3,"g",6),g(4,"g",7),w(5,"path",18),m()(),B(),g(6,"p"),b(7,"Browse File to upload!"),m()())}function be(t,e){if(t&1&&w(0,"img",19),t&2){let s=e.$implicit;P("src",s,K)}}function ke(t,e){t&1&&(g(0,"div",20),w(1,"app-loader"),m())}function Ie(t,e){if(t&1&&(g(0,"span",2),ee(1,be,1,1,"img",19,O,!1,ke,2,0,"div",20),m()),t&2){let s=M();v(),te(s.previews)}}function ze(t,e){t&1&&(g(0,"p",10),b(1,"Not selected file"),m())}function Fe(t,e){t&1&&(g(0,"p",11),b(1,"Please click to upload"),m())}function Ee(t,e){t&1&&(g(0,"span"),b(1,"Upload Image"),m())}function Pe(t,e){t&1&&(E(),g(0,"svg",22),w(1,"circle",23)(2,"path",24),m())}function De(t,e){if(t&1){let s=$();g(0,"button",21),D("click",function(){U(s);let n=M();return j(n.uploadFiles())}),_(1,Ee,2,0,"span")(2,Pe,3,0,":svg:svg",22),m()}if(t&2){let s=M();P("disabled",s.isLoading()),v(),S(s.isLoading()?2:1)}}var at=(()=>{let e=class e{constructor(i){this.zone=i,this.service=X(he),this.selectedFileNames=[],this.file=null,this.progressInfos=[],this.message=[],this.previews=[]}ngOnInit(){}selectFiles(i){this.message=[],this.progressInfos=[],this.selectedFileNames=[],this.selectedFiles=i.target.files;let n=i.target.files;if(this.previews=[],this.selectedFiles&&this.selectedFiles[0]){let o=this.selectedFiles.length;for(let a=0;a<o;a++){let r=new FileReader;r.onload=l=>{this.previews.push(l.target.result)},r.readAsDataURL(this.selectedFiles[a]),this.selectedFileNames.push(this.selectedFiles[a].name)}}}upload(i,n){this.progressInfos[i]={value:0,fileName:n},n&&(this.service.storeProfileImg.next(n),this.service.uploadImg(n).subscribe(o=>{o.type,ie.UploadProgress}))}isLoading(){return this.service.isLoading()}uploadFiles(){if(this.service.setLoading(!0),this.message=[],this.selectedFiles)for(let i=0;i<this.selectedFiles.length;i++)this.upload(i,this.selectedFiles[i])}};e.\u0275fac=function(n){return new(n||e)(V(N))},e.\u0275cmp=z({type:e,selectors:[["app-img-uploader"]],standalone:!0,features:[G([ue]),A],decls:21,vars:3,consts:[[1,"container"],[1,"header"],[1,""],["for","file",1,"footer"],["fill","#000000","viewBox","0 0 32 32","xmlns","http://www.w3.org/2000/svg"],["id","SVGRepo_bgCarrier","stroke-width","0"],["id","SVGRepo_tracerCarrier","stroke-linecap","round","stroke-linejoin","round"],["id","SVGRepo_iconCarrier"],["d","M15.331 6H8.5v20h15V14.154h-8.169z"],["d","M18.153 6h-.009v5.342H23.5v-.002z"],[1,"cursor-pointer"],[1,"cursor-pointer","text-xs"],["viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M5.16565 10.1534C5.07629 8.99181 5.99473 8 7.15975 8H16.8402C18.0053 8 18.9237 8.9918 18.8344 10.1534L18.142 19.1534C18.0619 20.1954 17.193 21 16.1479 21H7.85206C6.80699 21 5.93811 20.1954 5.85795 19.1534L5.16565 10.1534Z","stroke","#000000","stroke-width","2"],["d","M19.5 5H4.5","stroke","#000000","stroke-width","2","stroke-linecap","round"],["d","M10 3C10 2.44772 10.4477 2 11 2H13C13.5523 2 14 2.44772 14 3V5H10V3Z","stroke","#000000","stroke-width","2"],["id","file","type","file",3,"change"],["type","button",1,"text-blue","rounded","flex","items-center","justify-center",3,"disabled"],["d","M7 10V9C7 6.23858 9.23858 4 12 4C14.7614 4 17 6.23858 17 9V10C19.2091 10 21 11.7909 21 14C21 15.4806 20.1956 16.8084 19 17.5M7 10C4.79086 10 3 11.7909 3 14C3 15.4806 3.8044 16.8084 5 17.5M7 10C7.43285 10 7.84965 10.0688 8.24006 10.1959M12 12V21M12 12L15 15M12 12L9 15","stroke","#000000","stroke-width","1.5","stroke-linecap","round","stroke-linejoin","round"],[1,"border-2","border-dashed","border-blue","rounded-full",3,"src"],[1,"flex","items-center","justify-center"],["type","button",1,"text-blue","rounded","flex","items-center","justify-center",3,"click","disabled"],["xmlns","http://www.w3.org/2000/svg","fill","none","viewBox","0 0 24 24","stroke","currentColor",1,"animate-spin","h-5","w-5","text-blue"],["cx","12","cy","12","r","10","stroke","currentColor","stroke-width","4",1,"opacity-25"],["fill","currentColor","d","M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z",1,"opacity-75"]],template:function(n,o){n&1&&(g(0,"div",0),_(1,Me,8,0,"div",1)(2,Ie,4,1,"span",2),g(3,"label",3),E(),g(4,"svg",4),w(5,"g",5)(6,"g",6),g(7,"g",7),w(8,"path",8)(9,"path",9),m()(),_(10,ze,2,0,"p",10)(11,Fe,2,0,"p",11),g(12,"svg",12),w(13,"g",5)(14,"g",6),g(15,"g",7),w(16,"path",13)(17,"path",14)(18,"path",15),m()(),B(),g(19,"input",16),D("change",function(r){return o.selectFiles(r)}),m()(),_(20,De,3,2,"button",17),m()),n&2&&(v(),S(o.previews.length?2:1),v(9),S(o.previews.length?11:10),v(10),S(o.previews.length?20:-1))},dependencies:[T,fe,ne,oe,re,me,de,le,ae,se,ce,ge],styles:[".container[_ngcontent-%COMP%]{min-height:300px;height:fit-content;width:256px;border-radius:10px;box-shadow:4px 4px 30px #0003;display:flex;flex-direction:column;align-items:center;justify-content:space-between;padding:10px;gap:5px;background-color:#006eff0a}.header[_ngcontent-%COMP%]{flex:1;width:100%;border:2px dashed royalblue;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-direction:column}.header[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:100px}.header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{text-align:center;color:#000}.footer[_ngcontent-%COMP%]{background-color:#006eff13;width:100%;height:40px;padding:8px;border-radius:10px;cursor:pointer;display:flex;align-items:center;justify-content:flex-end;color:#000;border:none}.footer[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{height:130%;fill:#4169e1;background-color:#4642421a;border-radius:50%;padding:2px;cursor:pointer;box-shadow:0 2px 30px #00000034}.footer[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{flex:1;text-align:center}#file[_ngcontent-%COMP%]{display:none}"]});let t=e;return t})();export{me as a,at as b};
